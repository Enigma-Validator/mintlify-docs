{
  "openapi": "3.1.0",
  "info": {
    "title": "HL Indexer WebSocket API (EU)",
    "version": "1.0.0",
    "description": "Realtime WebSocket streams for live trading data from Hypedexer.\n\n**Base URL (EU)**: `wss://api-eu.hypedexer.com/ws`\n\nAll endpoints below are WebSocket upgrades. Use `X-API-Key` from your dashboard."
  },
  "servers": [
    {
      "url": "wss://api-eu.hypedexer.com/ws",
      "description": "EU WebSocket base"
    }
  ],
  "tags": [
    {
      "name": "WS-Multiplex",
      "description": "Generic `/ws` endpoint with dynamic subscribe/unsubscribe to multiple streams."
    },
    {
      "name": "WS-CompletedTrades",
      "description": "Dedicated WebSocket endpoints for completed trades streams."
    },
    {
      "name": "WS-Fills",
      "description": "Dedicated WebSocket endpoints for fills."
    },
    {
      "name": "WS-RecentActivity",
      "description": "Combined recent activity stream (trades + fills)."
    },
    {
      "name": "WS-Liquidations",
      "description": "Liquidations streams (multiplex + endpoint dédié)."
    },
    {
      "name": "WS-Echo",
      "description": "Echo test WebSocket."
    }
  ],
  "paths": {
    "/ws": {
      "get": {
        "tags": ["WS-Multiplex"],
        "summary": "Multiplex WebSocket (subscribe / unsubscribe)",
        "description": "Establish a WebSocket connection and manage **dynamic subscriptions**.\n\n### Authentication\nInclude the API key as a header during the handshake:\n\n```text\nX-API-Key: <your_api_key>\n```\n\n### Available subscriptions\n- `completed_trades` — all recent completed trades\n- `completed_trades` with `user` — trades for a specific user\n- `fills_spot` — spot fills stream\n- `recent_activity` — combined recent fills and trades\n- `liquidation` — liquidation events (optional filters: `user`, `amount_dollars`)\n\n### Client messages\nYou send JSON frames with a `method` and a `subscription` object.\n\n**Subscribe:**\n```json\n{ \"method\": \"subscribe\", \"subscription\": { \"type\": \"completed_trades\" } }\n```\n\n**Subscribe (user specific):**\n```json\n{ \"method\": \"subscribe\", \"subscription\": { \"type\": \"completed_trades\", \"user\": \"0x8fcc8f55d7a8cdaee770a9e4112725d4a2c60492\" } }\n```\n\n**Subscribe (spot fills):**\n```json\n{ \"method\": \"subscribe\", \"subscription\": { \"type\": \"fills_spot\" } }\n```\n\n**Subscribe (recent activity):**\n```json\n{ \"method\": \"subscribe\", \"subscription\": { \"type\": \"recent_activity\" } }\n```\n\n**Subscribe (liquidations, filtered):**\n```json\n{ \"method\": \"subscribe\", \"subscription\": { \"type\": \"liquidation\", \"amount_dollars\": 50000 } }\n```\n\n**Unsubscribe:**\n```json\n{ \"method\": \"unsubscribe\", \"subscription\": { \"type\": \"completed_trades\" } }\n```\n\nThe server sends JSON frames with `type` and payload data for each stream.",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "description": "Your Hypedexer API key.",
            "schema": {
              "type": "string",
              "example": "hl_live_ABCDEF.123456"
            }
          }
        ],
        "security": [
          {
            "X-API-Key": []
          }
        ],
        "responses": {
          "101": {
            "description": "Switching Protocols (WebSocket established)"
          },
          "401": {
            "description": "Unauthorized (invalid or missing API key)"
          }
        },
        "x-websocket": true,
        "x-codeSamples": [
          {
            "lang": "bash",
            "label": "wscat (multiplex)",
            "source": "wscat -H \"X-API-Key: <your_api_key>\" -c wss://api-eu.hypedexer.com/ws/ws\n# puis:\n# {\"method\":\"subscribe\",\"subscription\":{\"type\":\"completed_trades\"}}\n"
          },
          {
            "lang": "javascript",
            "label": "Browser (multiplex)",
            "source": "const ws = new WebSocket('wss://api-eu.hypedexer.com/ws/ws');\\nws.onopen = () => {\\n  ws.send(JSON.stringify({ method: 'subscribe', subscription: { type: 'liquidation', amount_dollars: 50000 } }));\\n};\\nws.onmessage = (e) => console.log(JSON.parse(e.data));\\n"
          }
        ],
        "x-examples": {
          "clientMessages": [
            { "method": "subscribe", "subscription": { "type": "completed_trades" } },
            { "method": "subscribe", "subscription": { "type": "completed_trades", "user": "0x8fcc8f55d7a8cdaee770a9e4112725d4a2c60492" } },
            { "method": "subscribe", "subscription": { "type": "fills_spot" } },
            { "method": "subscribe", "subscription": { "type": "recent_activity" } },
            { "method": "subscribe", "subscription": { "type": "liquidation" } },
            { "method": "subscribe", "subscription": { "type": "liquidation", "user": "0x8fcc8f55d7a8cdaee770a9e4112725d4a2c60492", "amount_dollars": 50000 } },
            { "method": "unsubscribe", "subscription": { "type": "completed_trades" } }
          ],
          "serverEvents": [
            {
              "type": "completed_trades",
              "count": 1,
              "data": [
                {
                  "trade_id": "t1",
                  "created_at": "2025-10-08T14:35:21.123Z",
                  "market": "BTC-PERP",
                  "price": 68500.5,
                  "size": 0.01,
                  "side": "B"
                }
              ]
            },
            {
              "type": "fills_spot",
              "count": 1,
              "data": [
                {
                  "fill_id": "f1",
                  "time_dt": "2025-10-08T14:35:50.000Z",
                  "market": "ETH-USDT",
                  "price": 1800.0,
                  "size": 0.5,
                  "side": "A"
                }
              ]
            },
            {
              "type": "recent_activity",
              "count": 2,
              "data": [
                { "stream": "completed_trades", "trade_id": "t3", "created_at": "2025-10-08T14:37:00Z" },
                { "stream": "fills_spot", "fill_id": "f2", "time_dt": "2025-10-08T14:37:05Z" }
              ]
            },
            {
              "type": "liquidation",
              "count": 1,
              "data": [
                {
                  "time": "2025-10-08T14:40:01.000Z",
                  "tid": 123456,
                  "market": "BTC-PERP",
                  "side": "long",
                  "size": 0.5,
                  "price": 68000,
                  "notional_usd": 34000,
                  "user": "0x8fcc8f55d7a8cdaee770a9e4112725d4a2c60492"
                }
              ]
            },
            { "type": "error", "message": "invalid subscription" }
          ]
        }
      }
    },

    "/liquidations": {
      "get": {
        "tags": ["WS-Liquidations"],
        "summary": "Liquidations stream (dedicated endpoint)",
        "description": "Low-level WebSocket that streams **liquidation events** from `liq_events`.\n\n- Messages are sent as individual events with `type: liquidation`.\n- No `subscribe/unsubscribe` protocol here (the whole connection is for liquidations).",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "description": "Your Hypedexer API key.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    },

    "/completed_trades": {
      "get": {
        "tags": ["WS-CompletedTrades"],
        "summary": "Completed trades stream",
        "description": "Dedicated WebSocket streaming `type: completed_trades` batches.\n\nUses an internal cursor based on `created_at`.",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "schema": { "type": "string" },
            "description": "Your Hypedexer API key."
          },
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 1, "maximum": 1000, "default": 200 },
            "description": "Server-side batch size for polling new rows."
          },
          {
            "name": "poll_ms",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 50, "maximum": 5000, "default": 500 },
            "description": "Polling interval in milliseconds."
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    },

    "/completed_trades_user/{user_address}": {
      "get": {
        "tags": ["WS-CompletedTrades"],
        "summary": "Completed trades stream for a specific user",
        "description": "Dedicated WebSocket for completed trades of a **single user**.\nMessages have `type: completed_trades_user` and include a `user` field.",
        "parameters": [
          {
            "name": "user_address",
            "in": "path",
            "required": true,
            "description": "User address (same format as REST)",
            "schema": { "type": "string" }
          },
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "schema": { "type": "string" },
            "description": "Your Hypedexer API key."
          },
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 1, "maximum": 1000, "default": 200 },
            "description": "Server-side batch size for polling new rows."
          },
          {
            "name": "poll_ms",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 50, "maximum": 5000, "default": 500 },
            "description": "Polling interval in milliseconds."
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    },

    "/fills_spot": {
      "get": {
        "tags": ["WS-Fills"],
        "summary": "Spot fills stream",
        "description": "Dedicated WebSocket streaming `type: fills_spot` batches.\n\nEquivalent to the REST fills/spot scope but in real time.",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "schema": { "type": "string" },
            "description": "Your Hypedexer API key."
          },
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 1, "maximum": 1000, "default": 200 },
            "description": "Server-side batch size for polling new rows."
          },
          {
            "name": "poll_ms",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 50, "maximum": 5000, "default": 500 },
            "description": "Polling interval in milliseconds."
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    },

    "/recent_activity": {
      "get": {
        "tags": ["WS-RecentActivity"],
        "summary": "Recent activity stream (trades + fills)",
        "description": "Dedicated WebSocket that merges new **completed trades** and **fills** into one stream.\n\nMessages have `type: recent_activity` and `data` entries tagged by `stream`.",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "schema": { "type": "string" },
            "description": "Your Hypedexer API key."
          },
          {
            "name": "batch_size",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 1, "maximum": 1000, "default": 200 },
            "description": "Server-side batch size for polling new rows."
          },
          {
            "name": "poll_ms",
            "in": "query",
            "required": false,
            "schema": { "type": "integer", "minimum": 50, "maximum": 5000, "default": 500 },
            "description": "Polling interval in milliseconds."
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    },

    "/echo": {
      "get": {
        "tags": ["WS-Echo"],
        "summary": "Echo test WebSocket",
        "description": "Simple echo WebSocket: every text frame sent by the client is sent back as-is.\nUseful to test connectivity and authentication.",
        "parameters": [
          {
            "name": "X-API-Key",
            "in": "header",
            "required": true,
            "schema": { "type": "string" },
            "description": "Your Hypedexer API key."
          }
        ],
        "responses": {
          "101": { "description": "Switching Protocols (WebSocket established)" },
          "401": { "description": "Unauthorized (invalid or missing API key)" }
        },
        "x-websocket": true
      }
    }
  },
  "components": {
    "securitySchemes": {
      "X-API-Key": {
        "type": "apiKey",
        "in": "header",
        "name": "X-API-Key",
        "description": "Your Hypedexer API key. Generate it from the dashboard and send it as `X-API-Key: <your_key>`."
      }
    },
    "schemas": {
      "WsSubscription": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "Subscription stream type.",
            "enum": [
              "completed_trades",
              "fills_spot",
              "recent_activity",
              "completed_trades_user",
              "liquidation"
            ]
          },
          "user": {
            "type": "string",
            "description": "When `type` is `completed_trades_user` this is required. For `liquidation` it is an optional filter to only receive events for that user.",
            "example": "0x8fcc8f55d7a8cdaee770a9e4112725d4a2c60492"
          },
          "amount_dollars": {
            "type": "number",
            "format": "double",
            "description": "Optional minimum liquidation size in USD notional to stream when `type` = `liquidation`.",
            "example": 50000
          }
        },
        "required": ["type"]
      },
      "WsClientMessageSubscribe": {
        "type": "object",
        "properties": {
          "method": { "type": "string", "const": "subscribe" },
          "subscription": { "$ref": "#/components/schemas/WsSubscription" }
        },
        "required": ["method", "subscription"]
      },
      "WsClientMessageUnsubscribe": {
        "type": "object",
        "properties": {
          "method": { "type": "string", "const": "unsubscribe" },
          "subscription": { "$ref": "#/components/schemas/WsSubscription" }
        },
        "required": ["method", "subscription"]
      },
      "WsClientMessage": {
        "oneOf": [
          { "$ref": "#/components/schemas/WsClientMessageSubscribe" },
          { "$ref": "#/components/schemas/WsClientMessageUnsubscribe" }
        ],
        "discriminator": {
          "propertyName": "method",
          "mapping": {
            "subscribe": "#/components/schemas/WsClientMessageSubscribe",
            "unsubscribe": "#/components/schemas/WsClientMessageUnsubscribe"
          }
        }
      }
    }
  },
  "security": [
    { "X-API-Key": [] }
  ]
}
